<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = [];

//fetchë¡œ ë°ì´í„°ë¥¼ ë°›ëŠ”ë‹¤
//fetch returns promise
//promise can work with then
//fetch()ë¥¼ ë¶ˆëŸ¬ë“¤ì´ëŠ” ê²½ìš°, ì·¨ë“í•  ë¦¬ì†ŒìŠ¤ë¥¼ ë°˜ë“œì‹œ ì¸ìˆ˜ë¡œ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ì½ì–´ë“¤ì¸ ë’¤,  fetch()ëŠ” Promiseê°ì²´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. 

// ... ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ì‹œ array ì†ì— arrayê°€ í˜•ì„±ëœë‹¤ (citiesë„ array, dataë„ arrayë¡œ citiesì— data arrayë¥¼ í†µìœ¼ë¡œ ë„£ìŒìœ¼ë¡œì¨ citiesì— ì²« ë²ˆì§¸ ë°°ì—´ì— data arrayê°€ í†µìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤)
// ... ì„ ì‚¬ìš©í•´ì„œ dataê°€ ì˜¨ì „í•œ ë°°ì—´ë¡œ citiesì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ í•œë‹¤
fetch(endpoint)
.then(blob => blob.json())
.then(data => cities.push(...data))

// ê°€ì§„ ë°°ì—´ ì¤‘ì— ì„œì¹˜í•œ ê²€ìƒ‰ì–´ì— ë§¤ì¹˜ê°€ ë˜ëŠ” ë°ì´í„°ë¥¼ ë°˜í™˜í•´ ì£¼ëŠ” í•¨ìˆ˜
function findMatches(wordToMatch, cities){
  return cities.filter(place => {
    // here we need to figure out if the city on state matches what was searched
    // how do we put a variable in to regular expression
    
    // create a regular expression
    // giëŠ” ì •ê·œ í‘œí˜„ì‹ì˜ ì˜µì…˜
    // g : ê¸€ë¡œë²Œì˜ ëœ». ì „ì—­ ë§¤ì¹­ì„ í•œë‹¤. ì²˜ìŒë¶€í„°ê°€ ì•„ë‹Œ ì „ì²´ì—ì„œ ì •ê·œì‹ì´ ë§ëŠ”ê±¸ ì°¾ëŠ”ë‹¤. 
    // i : case Insensitive, ëŒ€ì†Œë¬¸ì êµ¬ë³„ì•ˆí•¨
    const regex = new RegExp(wordToMatch, 'gi');

    //cityê°€ ë§ë“  stateê°€ ë§ë“  ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ë§ì•„ë„ return 
    return place.city.match(regex) || place.state.match(regex)
  });
}

// population ë‹¨ìœ„ë§ˆë‹¤ , ì°ì–´ì£¼ëŠ” í•¨ìˆ˜
function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches(){
  const matchArray = findMatches(this.value, cities);
  console.log(matchArray);
  const html = matchArray.map(place => {
    //ê²€ìƒ‰í•œ ë‹¨ì–´ê°€ ì‹œí‹° ì´ë¦„ ì¤‘ ë§¤ì¹˜ë˜ëŠ” ë¶€ë¶„ì— highlight ë˜ë„ë¡ ì„¤ì •
    const regex = new RegExp(this.value, 'gi');
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);

    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>  
        <span class="poplution">${numberWithCommas(place.population)}</span>
      </li>
    `;
  }).join('');
  suggestions.innerHTML = html;
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

//change event fires when you go off that input => so that displayMatches event fires when you focus out from input
searchInput.addEventListener('change', displayMatches);
//ê·¸ë ‡ê¸° ë•Œë¬¸ì— keyê°€ ëˆŒë¦´ ë•Œë§ˆë‹¤ ì…ë ¥ëœ ë¬¸ìë¥¼ ì¸ì§€í•˜ê¸° ìœ„í•´ì„œ keyup ì´ë²¤íŠ¸ì—ë„ displayMatchesë¥¼ ê±¸ì–´ì¤€ë‹¤
searchInput.addEventListener('keyup', displayMatches);




</script>
</body>
</html>
